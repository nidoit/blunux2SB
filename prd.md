# PRD: blunux2 — Custom Arch-Based Linux Distribution

**Version:** 1.1
**Author:** Jaewoo Joung
**Date:** 2026-02-20
**Status:** Draft (updated to match actual codebase)

---

## 1. Overview

**blunux2** is a custom Linux distribution built on Arch Linux. It provides a Live ISO experience with a graphical installer, pre-configured KDE Plasma desktop, and a curated software stack — targeting users who want an Arch-based system without manual setup complexity.

The key design principle: a single **`config.toml`** file controls everything. Users edit (or generate) this file, and all tooling reads from it — from the ISO build to the disk installer.

---

## 2. Architecture Overview

```
┌─────────────────────────────────────────────────────────────────┐
│                      blunux2 Distribution                        │
├──────────────┬──────────────┬──────────────┬────────────────────┤
│ ISO Build    │ Live Boot    │ AUR Setup    │ Disk Installation  │
│ System       │ System       │              │ (Calamares)        │
├──────────────┼──────────────┼──────────────┼────────────────────┤
│ Julia        │ BIOS:        │ blunux-setup │ config.toml →      │
│ build.jl     │ syslinux     │ (Rust +      │ blunux-toml2cal →  │
│ (dev-side    │ UEFI:        │ bash)        │ Calamares YAML     │
│ only, not    │ systemd-boot │ • yay        │ ext4 default       │
│ in ISO)      │ initramfs    │ • calamares  │ grub/sd-boot/nmbl  │
│              │ squashfs     │ • input meth │                    │
│              │ overlayfs    │              │                    │
└──────────────┴──────────────┴──────────────┴────────────────────┘
     ↑ Developer machine                ↑ Inside the ISO
```

**Key distinctions:**
- Julia runs **only on the developer's machine** to orchestrate the ISO build. It is NOT shipped inside the ISO.
- The ISO contains four Rust binaries + bash scripts. No Python, no Julia at runtime.
- The `airootfs/` overlay is **dynamically generated** by `build.jl` — it does not exist statically in the repo.

---

## 3. Repository Structure

```
blunux2SB/
├── config.toml                        # User configuration (single source of truth)
├── build.jl                           # Julia ISO build orchestrator (dev machine only)
├── prd.md                             # This document
├── Cargo.toml                         # Rust workspace (4 crates)
│
├── profile/                           # archiso profile (static parts)
│   ├── profiledef.sh                  #   ISO master config (name, boot modes, squashfs)
│   ├── pacman.conf                    #   pacman config for ISO build
│   ├── grub/grub.cfg                  #   GRUB config (for grub bootloader option)
│   ├── syslinux/syslinux.cfg          #   BIOS boot config
│   └── efiboot/loader/                #   UEFI systemd-boot config
│   [airootfs/ is generated by build.jl, not stored in repo]
│
├── crates/
│   ├── blunux-config/                 # Shared config types (library crate)
│   │   └── src/lib.rs                 #   BlunuxConfig struct, TOML load/save
│   │
│   ├── wizard/                        # Live session hardware wizard
│   │   └── src/
│   │       ├── main.rs                #   hw detect → locale → keyboard → (optional) desktop
│   │       └── hwdetect.rs            #   GPU/audio/UEFI/RAM detection via /sys, /proc
│   │
│   ├── toml2cal/                      # config.toml → Calamares YAML translator
│   │   └── src/
│   │       ├── main.rs                #   CLI: generate, apply-packages, apply-input-method
│   │       ├── generate.rs            #   9 Calamares YAML generators
│   │       └── packages.rs            #   bool flags → pacman package names
│   │
│   └── setup/                         # AUR package installer + system configurator
│       └── src/
│           ├── main.rs                #   yay bootstrap → calamares → packages → input method → services
│           └── packages.rs            #   bool flags → package names (mirrors toml2cal/packages.rs)
│
└── scripts/
    ├── startblunux                    # Live session entry point (bash)
    ├── calamares-blunux               # Installer wrapper (bash)
    └── blunux-setup                   # Bash fallback setup script (also curl-installable)
```

### Rust Workspace (Cargo.toml)

```toml
[workspace]
members = [
    "crates/blunux-config",   # Shared library: BlunuxConfig struct
    "crates/toml2cal",        # Binary: blunux-toml2cal
    "crates/wizard",          # Binary: blunux-wizard
    "crates/setup",           # Binary: blunux-setup
]
resolver = "2"
```

**Build outputs:**
- `target/release/blunux-wizard` — Hardware wizard (live session)
- `target/release/blunux-toml2cal` — TOML→Calamares translator (installer)
- `target/release/blunux-setup` — AUR package installer (live session)

---

## 4. Subsystem 1: ISO Build System

### 4.1 Foundation — archiso

The ISO is built using **archiso** (`mkarchiso`). The `profile/` directory contains static parts of the archiso profile. The dynamic parts (airootfs overlay, packages list) are generated by `build.jl`.

### 4.2 profiledef.sh — Master Configuration

```bash
#!/usr/bin/env bash

iso_name="blunux2"
iso_label="BLUNUX2_$(date +%Y%m)"
iso_publisher="blunux2 Project <https://blunux2.dev>"
iso_application="blunux2 Live/Install Medium"
iso_version="$(date +%Y.%m.%d)"
install_dir="arch"
buildmodes=('iso')
bootmodes=(
    'bios.syslinux'        # Legacy BIOS
    'uefi.systemd-boot'    # UEFI via systemd-boot
)
arch="x86_64"
pacman_conf="pacman.conf"
airootfs_image_type="squashfs"
airootfs_image_tool_options=(
    '-comp' 'zstd' '-Xcompression-level' '15'
    '-b' '1M'
)
file_permissions=(
    ["/etc/shadow"]="0:0:400"
    ["/usr/bin/startblunux"]="0:0:755"
    ["/usr/bin/blunux-wizard"]="0:0:755"
    ["/usr/bin/calamares-blunux"]="0:0:755"
    ["/usr/bin/blunux-toml2cal"]="0:0:755"
)
```

**Note:** The ISO uses **systemd-boot for UEFI** (not GRUB). The bootloader used on the *installed system* is separately configured in `config.toml` and can be grub, systemd-boot, or nmbl (EFISTUB).

### 4.3 What build.jl Does

`build.jl` is a Julia script that runs on the developer's machine. It:

1. **Reads `config.toml`** — parses all user configuration
2. **Generates `packages.x86_64`** — maps config booleans to pacman package names
3. **Generates `airootfs/` overlay** — hostname, locale.conf, vconsole.conf, copies config.toml to `/usr/share/blunux/`
4. **Builds Rust binaries** — `cargo build --release` → copies `blunux-wizard`, `blunux-toml2cal`, `blunux-setup` into `airootfs/usr/bin/`
5. **Copies scripts** — `startblunux`, `calamares-blunux` → `airootfs/usr/bin/`
6. **Calls `mkarchiso`** — standard archiso ISO build

#### Build Commands

```bash
# Full build
julia build.jl

# Profile only (inspect without building ISO)
julia build.jl --profile-only

# Skip Rust build (reuse existing binaries)
julia build.jl --skip-rust

# Manual build (without Julia)
cargo build --release
cp target/release/blunux-{wizard,toml2cal,setup} profile/airootfs/usr/bin/
cp scripts/{startblunux,calamares-blunux} profile/airootfs/usr/bin/
sudo mkarchiso -v -w /tmp/blunux2-work -o out/ profile/
```

#### What mkarchiso Does Internally

1. **pacstrap** — installs `packages.x86_64` into a working rootfs
2. **Overlay airootfs/** — copies configs over the installed rootfs
3. **mkinitcpio** — generates initramfs with archiso hooks
4. **SquashFS** — compresses rootfs into `airootfs.sfs` (~2-4GB → ~1.5-2.5GB)
5. **ISO assembly** — bootloaders + kernel + initramfs + squashfs → hybrid ISO

---

## 5. Subsystem 2: Live Boot Process

### 5.1 Boot Flow

```
Firmware → Bootloader → initramfs (archiso hooks) → systemd → startblunux
BIOS:         syslinux
UEFI:         systemd-boot
                               ↓
                    squashfs + overlayfs mounted
                               ↓
              SDDM auto-login as liveuser → startblunux
```

### 5.2 Boot Modes

**UEFI path:**
1. Firmware reads ESP → loads systemd-boot
2. systemd-boot reads `loader/entries/blunux.conf`
3. Boots kernel with archiso parameters

**BIOS path:**
1. Firmware reads MBR → loads syslinux
2. syslinux reads `syslinux.cfg`

### 5.3 initramfs — Live Boot Magic

The `archiso` hook in initramfs:

1. Finds the boot device by label (`BLUNUX2_YYYYMM`)
2. Mounts the ISO filesystem
3. Locates and mounts `airootfs.sfs` (squashfs, read-only)
4. Creates overlayfs:

```
┌────────────────────────────────┐
│        overlayfs (merged)      │  ← What the user sees as /
├────────────────────────────────┤
│   upperdir (tmpfs in RAM)      │  ← All writes (volatile, lost on reboot)
├────────────────────────────────┤
│   lowerdir (squashfs, ro)      │  ← The compressed root image
└────────────────────────────────┘
```

5. `switch_root` hands control to systemd

### 5.4 Live Session Startup (3-Step Flow)

The live session entry point is `startblunux` (bash), which runs 3 steps in sequence:

```bash
# /usr/bin/startblunux — simplified

# Step 1: Hardware detection + locale/keyboard setup
blunux-wizard --no-desktop

# Step 2: AUR package installation (calamares, input method, etc.)
blunux-setup --live --config /usr/share/blunux/config.toml

# Step 3: Launch desktop (bash exec — replaces this process)
exec startplasma-wayland
```

The wizard does **not** exec the desktop directly — it uses `--no-desktop` and the bash script controls the sequence and the final `exec startplasma-wayland`.

---

## 6. Subsystem 3: Rust Crates

### 6.1 blunux-config (shared library)

Defines the `BlunuxConfig` struct that mirrors `config.toml` exactly. All other crates depend on this for type-safe config parsing.

```rust
pub struct BlunuxConfig {
    pub blunux: BlunuxMeta,        // version, name
    pub locale: Locale,            // language, timezone, keyboard
    pub input_method: InputMethod, // enabled, engine (kime/fcitx5/ibus)
    pub kernel: Kernel,            // type (linux/linux-lts/linux-zen)
    pub install: Install,          // bootloader, hostname, username, passwords, encryption, autologin
    pub disk: Disk,                // swap (none/small/suspend/file)
    pub packages: Packages,        // desktop, browser, office, development, multimedia,
                                   // gaming, virtualization, communication, utility
}
```

Methods: `BlunuxConfig::load(path)`, `BlunuxConfig::save(path)`.

### 6.2 wizard (blunux-wizard binary)

Runs at live session startup. Terminal-based (no GUI). Supports `--no-desktop` flag.

**Flow:**
1. **Hardware detection** (`hwdetect.rs`):
   - GPU: reads `/sys/class/drm/card*/device/vendor` → NVIDIA (0x10de), AMD (0x1002), Intel (0x8086)
   - Audio: checks `/proc/asound/cards`
   - UEFI: checks `/sys/firmware/efi`
   - RAM: reads `/proc/meminfo`
2. **Load config.toml** from `/usr/share/blunux/config.toml`
3. **Apply locale** to live session: `localectl set-locale`, `timedatectl set-timezone`
4. **Apply keyboard** to live session: `localectl set-x11-keymap`
5. **Desktop exec** — skipped when `--no-desktop` is passed (the bash wrapper handles it)

**Driver auto-selection** (reported at boot, applied during installation via shellprocess):
- NVIDIA → `nvidia-dkms`, `nvidia-utils`, `lib32-nvidia-utils`, `nvidia-settings`
- AMD → `mesa`, `vulkan-radeon`, `lib32-mesa`, `lib32-vulkan-radeon`, `xf86-video-amdgpu`
- Intel → `mesa`, `vulkan-intel`, `lib32-mesa`, `lib32-vulkan-intel`, `intel-media-driver`
- Unknown → `mesa`

### 6.3 setup (blunux-setup binary)

Runs at live session startup after the wizard. Handles AUR packages and system configuration that requires network and takes time.

**Flow:**
1. **Bootstrap yay** — if not present, clones `yay-bin` from AUR and builds via `makepkg`
2. **Live mode (`--live`)** — installs `calamares` and `calamares-extensions` via yay
3. **Install user packages** — resolves `config.toml [packages.*]` booleans to package names, installs via yay
4. **Input method setup** — based on `config.toml [input_method]`:
   - **kime**: installs `kime`, writes `~/.config/kime/config.yaml` (dubeolsik layout), writes `~/.config/autostart/kime.desktop`, writes `/etc/environment.d/input-method.conf`
   - **fcitx5**: installs fcitx5 + hangul + gtk + qt + configtool, writes environment config
   - **ibus**: installs ibus + ibus-hangul, writes environment config
5. **Enable services** — `NetworkManager`, `sddm`, `bluetooth`, `docker` (as applicable via config)

**Bash fallback (`scripts/blunux-setup`):**

A bash script that mirrors the Rust binary's behavior. Used as:
- Fallback if the compiled binary is unavailable (the bash `startblunux` checks for both)
- Bootstrap on a fresh Arch install via curl: `curl -sL .../blunux-setup | bash`

### 6.4 toml2cal (blunux-toml2cal binary)

Translates `config.toml` into Calamares YAML configuration files. Called by `calamares-blunux` before launching the installer.

**CLI subcommands:**
```bash
# Generate all Calamares YAML configs
blunux-toml2cal generate \
    --input config.toml \
    --output-dir /etc/calamares/modules \
    --settings /etc/calamares/settings.conf

# Install packages listed in config.toml [packages.*]
blunux-toml2cal apply-packages --input config.toml

# Configure input method from config.toml [input_method]
blunux-toml2cal apply-input-method --input config.toml
```

**Generated files (9 module configs + settings.conf):**

| File | Calamares module | Generated from |
|------|-----------------|----------------|
| `settings.conf` | pipeline | bootloader choice, encryption flag |
| `locale.conf` | locale | `[locale]` language, timezone |
| `keyboard.conf` | keyboard | `[locale]` keyboard |
| `partition.conf` | partition | `[disk]` swap, `[install]` encryption |
| `users.conf` | users | `[install]` username, hostname, autologin |
| `bootloader.conf` | bootloader | `[install]` bootloader |
| `unpackfs.conf` | unpackfs | (static) squashfs source path |
| `shellprocess.conf` | shellprocess | kernel, packages, input method, bootloader |
| `services-systemd.conf` | services-systemd | desktop, bluetooth, docker flags |
| `displaymanager.conf` | displaymanager | KDE → sddm, autologin |

**Bootloader logic in `settings.conf` generation:**
- `grub` → adds `grubcfg` + `bootloader` modules to exec pipeline
- `systemd-boot` → adds `bootloader` module only
- `nmbl` (EFISTUB) → skips bootloader module entirely; `shellprocess.conf` handles `efibootmgr`

**Package resolver (`packages.rs`, identical logic in both `toml2cal` and `setup` crates):**

| config.toml key | Resolved packages |
|----------------|---------|
| `packages.desktop.kde = true` | plasma-desktop, plasma-workspace, sddm, konsole, dolphin, kate, ark, spectacle, xdg-desktop-portal-kde |
| `packages.browser.firefox` | firefox |
| `packages.browser.whale` | naver-whale-bin (AUR) |
| `packages.browser.chrome` | google-chrome (AUR) |
| `packages.browser.mullvad` | mullvad-browser-bin (AUR) |
| `packages.office.libreoffice` | libreoffice-fresh |
| `packages.office.hoffice` | hoffice-bin (AUR) |
| `packages.office.texlive` | texlive-core, texlive-latexextra |
| `packages.development.vscode` | visual-studio-code-bin (AUR) |
| `packages.development.sublime` | sublime-text-4 (AUR) |
| `packages.development.rust` | rustup |
| `packages.development.julia` | julia |
| `packages.development.nodejs` | nodejs, npm |
| `packages.development.github_cli` | github-cli |
| `packages.multimedia.obs` | obs-studio |
| `packages.multimedia.vlc` | vlc |
| `packages.multimedia.freetv` | freetuxtv |
| `packages.multimedia.ytdlp` | yt-dlp |
| `packages.multimedia.freetube` | freetube-bin (AUR) |
| `packages.gaming.steam` | steam, lib32-mesa, lib32-vulkan-radeon |
| `packages.gaming.unciv` | unciv-bin (AUR) |
| `packages.gaming.snes9x` | snes9x-gtk |
| `packages.virtualization.docker` | docker, docker-compose |
| `packages.virtualization.virtualbox` | virtualbox, virtualbox-host-dkms |
| `packages.communication.teams` | teams-for-linux-bin (AUR) |
| `packages.communication.whatsapp` | whatsapp-for-linux |
| `packages.communication.onenote` | p3x-onenote-bin (AUR) |
| `packages.utility.bluetooth` | bluez, bluez-utils, bluedevil |
| `packages.utility.vnc` | tigervnc |
| `packages.utility.samba` | samba, smbclient |
| `packages.utility.conky` | conky |
| `kernel.type != "linux"` | `<kernel>`, `<kernel>-headers` |

---

## 7. Subsystem 4: config.toml — Single Source of Truth

`config.toml` is the only file users interact with. It controls both the live session wizard and the disk installer.

```toml
[blunux]
version = "2.0"
name = "my-blunux-build"

[locale]
language = ["ko_KR"]
timezone = "Europe/Stockholm"
keyboard = ["kr", "us"]

[input_method]
enabled = true
engine = "kime"              # kime | fcitx5 | ibus

[kernel]
type = "linux"               # linux | linux-lts | linux-zen

[install]
bootloader = "systemd-boot"  # grub | systemd-boot | nmbl
hostname = "nux"
username = "blu"
root_password = "1234"
user_password = "1234"
encryption = false
autologin = true

[disk]
swap = "suspend"             # none | small | suspend | file

[packages.desktop]
kde = true

[packages.browser]
firefox = true
whale = false
chrome = false
mullvad = false

[packages.office]
libreoffice = true
hoffice = false
texlive = false

[packages.development]
vscode = true
sublime = false
rust = true
julia = true
nodejs = true
github_cli = false

[packages.multimedia]
obs = false
vlc = false
freetv = false
ytdlp = false
freetube = false

[packages.gaming]
steam = false
unciv = false
snes9x = false

[packages.virtualization]
virtualbox = false
docker = false

[packages.communication]
teams = false
whatsapp = false
onenote = false

[packages.utility]
conky = false
vnc = false
samba = false
bluetooth = true
```

---

## 8. Subsystem 5: Disk Installation (Calamares)

### 8.1 Installation Flow

```
User edits config.toml
        │
        ▼
calamares-blunux (bash wrapper)
        │
        ▼
blunux-toml2cal generate   →   /etc/calamares/settings.conf
                           →   /etc/calamares/modules/*.conf (9 files)
        │
        ▼
calamares (GUI installer)
  show:  welcome → locale → keyboard → partition → users → summary
  exec:  partition → mount → unpackfs → machineid → fstab → locale
         → keyboard → localecfg → [luksbootkeyfile] → users
         → displaymanager → networkcfg → hwclock → services-systemd
         → shellprocess → [grubcfg] → [bootloader] → umount
  show:  finished
```

### 8.2 The Critical Step: unpackfs

```yaml
# unpackfs.conf (static — same for all installs)
unpack:
  - source: /run/miso/bootmnt/arch/x86_64/airootfs.sfs
    sourcefs: squashfs
    destination: ""
```

Extracts the live squashfs image to the target disk partition.

### 8.3 Partition Layout

- EFI partition: 512M at `/boot/efi`
- Root: ext4 (only supported filesystem — hardcoded in `partition_conf()`)
- Swap: controlled by `[disk] swap` in config.toml

### 8.4 Bootloader Options

| config.toml value | Installed bootloader | Calamares modules used |
|-------------------|---------------------|-------------------|
| `grub` | GRUB (BIOS + UEFI) | grubcfg + bootloader |
| `systemd-boot` | systemd-boot (UEFI only) | bootloader |
| `nmbl` | None — EFISTUB direct boot via efibootmgr | shellprocess only |

### 8.5 Post-Install (shellprocess.conf)

Generated by `blunux-toml2cal` from config.toml contents:

1. Remove live packages: `pacman -Rns mkinitcpio-archiso`
2. Install non-default kernel if `kernel.type != "linux"`: `pacman -S <kernel> <kernel>-headers`
3. Regenerate initramfs: `mkinitcpio -P`
4. EFISTUB entry if `bootloader = "nmbl"`: `efibootmgr --create ...`
5. Install user-selected packages: `pacman -S --noconfirm --needed <packages>`
6. Install input method packages + write `/etc/environment.d/input-method.conf`
7. Copy live session theme: `cp /home/liveuser/.config/plasma* $ROOT/etc/skel/.config/`
8. Clean pacman cache: `pacman -Scc`
9. Set GRUB kernel parameters if `bootloader = "grub"`: `sed -i 's/GRUB_CMDLINE.../` on `/etc/default/grub`

---

## 9. ISO Image Structure

```
blunux2-2026.MM.DD-x86_64.iso
├── arch/
│   ├── boot/x86_64/
│   │   ├── vmlinuz-linux          # Linux kernel
│   │   └── initramfs-linux.img    # initramfs with archiso hooks
│   └── x86_64/
│       └── airootfs.sfs           # SquashFS compressed root
├── loader/                         # systemd-boot config (UEFI)
│   └── entries/blunux.conf
├── syslinux/
│   ├── syslinux.cfg               # BIOS boot config
│   └── splash.png
└── [El Torito catalog]             # For CD/DVD booting
```

**Key binaries inside `airootfs.sfs`:**
```
/usr/bin/
├── startblunux          # Live session entry point (bash, 3-step flow)
├── blunux-wizard        # Hardware detect + locale/keyboard (Rust)
├── blunux-setup         # AUR installer: yay + calamares + packages + input method (Rust)
├── blunux-toml2cal      # config.toml → Calamares YAML (Rust)
└── calamares-blunux     # Installer wrapper: toml2cal → calamares (bash)
/usr/share/blunux/
└── config.toml          # User configuration (copied from repo by build.jl)
```

---

## 10. Key Technology Decisions

| Decision | Choice | Rationale |
|----------|--------|-----------|
| Base | Arch Linux | Rolling release, AUR access, latest packages |
| ISO tool | archiso + mkarchiso | Official, well-maintained |
| Compression | SquashFS + zstd | Best ratio for live media |
| Root FS overlay | overlayfs (tmpfs upper) | Standard Linux, volatile by design |
| UEFI bootloader (ISO) | systemd-boot | Lighter than GRUB, modern |
| BIOS bootloader (ISO) | syslinux | Lightweight, reliable for legacy |
| Installed system bootloader | grub / systemd-boot / nmbl | User choice in config.toml |
| Installer | Calamares (config.toml-driven) | Universal framework |
| Install config | config.toml → Calamares YAML | User edits TOML; Rust generates YAML |
| Default filesystem | ext4 | Simple, stable, universal |
| Desktop | KDE Plasma 6 | Wayland-ready, highly customizable |
| Display manager | SDDM | Native KDE integration |
| Hardware wizard | Rust (`blunux-wizard`, terminal) | GPU/audio/UEFI/RAM detect; applies locale/keyboard |
| AUR installer | Rust (`blunux-setup`) + bash fallback | yay bootstrap, packages, input method config |
| Config translator | Rust (`blunux-toml2cal`) | config.toml → 9 Calamares YAML files |
| Shared config types | Rust (`blunux-config`) | Type-safe config parsing shared across all crates |
| ISO build orchestrator | Julia (`build.jl`) | Dev-side only; config.toml → profile → ISO |
| AUR helper | yay | Handles both official repos and AUR seamlessly |
| Input methods | kime (default) / fcitx5 / ibus | Korean input; kime configured with dubeolsik layout |
| No Python | — | Zero Python dependency at ISO runtime |
| No Julia in ISO | — | Julia is build-side orchestration only |

---

## 11. Development Workflow

### Prerequisites

```bash
# Developer machine (Arch-based)
sudo pacman -S archiso

# Julia (for build.jl)
julia -e 'using Pkg; Pkg.add("TOML")'

# Rust (via rustup)
rustup default stable
```

### Build Cycle

```bash
# 1. Edit config.toml
vim config.toml

# 2. Build ISO (Rust compilation + archiso profile + ISO image)
julia build.jl

# 3. Test in QEMU
run_archiso -u -i out/blunux2-*.iso   # UEFI
run_archiso -i out/blunux2-*.iso       # BIOS

# 4. Flash to USB for real hardware testing
dd bs=4M if=out/blunux2-*.iso of=/dev/sdX status=progress

# Rust-only development
cargo check
cargo build --release
cargo test
```

### Environment Variables

| Variable | Default | Description |
|----------|---------|-------------|
| `BLUNUX_WORK` | `/tmp/blunux2-work` | mkarchiso working directory |
| `BLUNUX_OUT` | `./out` | ISO output directory |

---

## 12. What Is and Isn't Implemented

### Implemented (in codebase)

- `BlunuxConfig` struct with full TOML parsing for all sections and package categories
- `blunux-wizard`: GPU/audio/UEFI/RAM detection, locale/keyboard apply to live session, `--no-desktop` flag
- `blunux-toml2cal`: all 9 Calamares YAML generators, all 3 bootloader modes, full package resolver
- `blunux-setup`: yay bootstrap, calamares install (live mode), package install via yay, kime/fcitx5/ibus full setup (config files + autostart + env vars), service enable
- `startblunux`: 3-step live session flow (wizard → setup → plasma exec)
- `calamares-blunux`: toml2cal → calamares launcher
- `profile/profiledef.sh`: syslinux + systemd-boot boot modes, squashfs/zstd configuration
- `scripts/blunux-setup`: bash fallback for the Rust binary, also curl-installable on fresh Arch
- `build.jl`: Julia orchestrator (config.toml → profile generation → Rust build → mkarchiso)

### Not Yet Implemented / Planned

- GUI for `config.toml` editing (currently text-file only)
- Custom package repository (`repo.blunux2.dev`) for blunux2-specific packages
- Persistent live USB support (secondary ext4 partition for saving changes)
- GitHub Actions CI/CD pipeline (monthly ISO builds)
- ARM64 port
- Snapshot/Timeshift integration
- Welcome app / post-install guide

---

## 13. References

- [Arch Wiki — archiso](https://wiki.archlinux.org/title/Archiso)
- [Arch Wiki — mkinitcpio](https://wiki.archlinux.org/title/Mkinitcpio)
- [Calamares Documentation](https://github.com/calamares/calamares/wiki)
- [kime — Korean input method](https://github.com/Riey/kime)
- [systemd-boot](https://wiki.archlinux.org/title/Systemd-boot)
- [ALCI — Arch Linux Calamares Installer](https://alci.online/)
